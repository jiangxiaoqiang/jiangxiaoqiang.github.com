<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Gradle," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="使用以下配置文件对Gradle的构建进行配置：

Gradle构建脚本（build.gradle）指定了一个项目和它的任务。
Gradle属性文件（gradle.properties）用来配置构建属性。
Gradle设置文件（gradle.settings）对于只有一个项目的构建而言是可选的，如果我们的构建中包含多于一个项目，那么它就是必须的，因为它描述了哪一个项目参与构建。每一个多项目的构建都必">
<meta property="og:type" content="article">
<meta property="og:title" content="Gradle使用经验总结">
<meta property="og:url" content="http://jiangxiaoqiang.com/2016/12/27/gradle-using/index.html">
<meta property="og:site_name" content="小强的博客">
<meta property="og:description" content="使用以下配置文件对Gradle的构建进行配置：

Gradle构建脚本（build.gradle）指定了一个项目和它的任务。
Gradle属性文件（gradle.properties）用来配置构建属性。
Gradle设置文件（gradle.settings）对于只有一个项目的构建而言是可选的，如果我们的构建中包含多于一个项目，那么它就是必须的，因为它描述了哪一个项目参与构建。每一个多项目的构建都必">
<meta property="og:image" content="http://jiangxiaoqiang.com/2016/12/27/gradle-using/gradle-build-workflow.jpg">
<meta property="og:updated_time" content="2017-04-03T06:41:38.396Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Gradle使用经验总结">
<meta name="twitter:description" content="使用以下配置文件对Gradle的构建进行配置：

Gradle构建脚本（build.gradle）指定了一个项目和它的任务。
Gradle属性文件（gradle.properties）用来配置构建属性。
Gradle设置文件（gradle.settings）对于只有一个项目的构建而言是可选的，如果我们的构建中包含多于一个项目，那么它就是必须的，因为它描述了哪一个项目参与构建。每一个多项目的构建都必">
<meta name="twitter:image" content="http://jiangxiaoqiang.com/2016/12/27/gradle-using/gradle-build-workflow.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jiangxiaoqiang.com/2016/12/27/gradle-using/"/>





  <title> Gradle使用经验总结 | 小强的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-84391638-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">小强的博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://jiangxiaoqiang.com/2016/12/27/gradle-using/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="xiaoqiang jiang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="小强的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="小强的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Gradle使用经验总结
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-27T16:23:37+08:00">
                2016-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tool/" itemprop="url" rel="index">
                    <span itemprop="name">Tool</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/27/gradle-using/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/27/gradle-using/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>使用以下配置文件对Gradle的构建进行配置：</p>
<ul>
<li>Gradle构建脚本（build.gradle）指定了一个项目和它的任务。</li>
<li>Gradle属性文件（gradle.properties）用来配置构建属性。</li>
<li>Gradle设置文件（gradle.settings）对于只有一个项目的构建而言是可选的，如果我们的构建中包含多于一个项目，那么它就是必须的，因为它描述了哪一个项目参与构建。每一个多项目的构建都必须在项目结构的根目录中加入一个设置文件。</li>
</ul>
<a id="more"></a>
<p>Gradle 是以 Groovy 语言为基础, 基于DSL (领域特定语言Domain Specifies language) 语法的自动化构建工具, 但是它增加了一些额外的特性, 这使得Gradle更加的容易去阐释构建.一个构建脚本能够包含任何Groovy语言的元素 ( Any language element except for statement labels), 每个构建脚本都使用UTF-8编码.</p>
<h4 id="为什么使用Gradle"><a href="#为什么使用Gradle" class="headerlink" title="为什么使用Gradle"></a>为什么使用Gradle</h4><ul>
<li>与Maven和Ant相比较，Maven和Ant的XML配置文件比较复杂。</li>
<li>Gradle提供更细粒度的操作，自由定制化空间大</li>
<li>与Maven和Ant完全兼容</li>
<li>Gradle对多语言、多平台有更原生(natural)的支持</li>
<li>DSL(Domain Specific Language)比XML更简洁高效</li>
</ul>
<h4 id="手动安装Gradle"><a href="#手动安装Gradle" class="headerlink" title="手动安装Gradle"></a>手动安装Gradle</h4><p>下载Gradle，解压到指定文件夹，在用户根目录下的<code>.bash_profile</code>文件中，设置环境变量如下代码片段所示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> GRADLE_HOME=/opt/<span class="built_in">local</span>/tools/gradle-2.12</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SONAR_HOME</span>/bin:<span class="variable">$SONAR_SCANNER</span>/bin:<span class="variable">$GRADLE_HOME</span>/bin</div><div class="line"></div><div class="line"><span class="comment"># 使环境变量生效</span></div><div class="line"><span class="built_in">source</span> .bash_profile</div></pre></td></tr></table></figure>
<p>非手动安装时，可以输入如下命令查看gradle的home目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gradle getHomeDir</div><div class="line"><span class="comment"># Mac下</span></div><div class="line">brew info gradle</div></pre></td></tr></table></figure>
<p>注意在Intellij Idea下设置gradle的目录为<code>/usr/local/Cellar/gradle/3.2.1/libexec</code>。</p>
<h4 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h4><p>在Ubuntu 16.04 LTS中安装Gradle:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo apt install gradle -y</div><div class="line"></div><div class="line"><span class="comment"># 安装指定版本的Gradle</span></div><div class="line">sudo apt install -y gradle=2.12</div></pre></td></tr></table></figure>
<p>如下列出了Gradle常用的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看所有任务</span></div><div class="line">gradle task</div><div class="line"><span class="comment"># 查看所有的任务(会列出task之间的依赖关系)</span></div><div class="line">gradle task --all</div><div class="line"></div><div class="line"><span class="comment"># 查看所有项目(查看所有项目要切换到项目的根目录执行命令)</span></div><div class="line">gradle projects</div><div class="line"></div><div class="line"><span class="comment"># 清楚app目录下的build文件夹</span></div><div class="line">gradle clean</div><div class="line"></div><div class="line"><span class="comment"># 检查依赖并编译打包 （正式和测试）</span></div><div class="line">gradle build</div><div class="line"></div><div class="line"><span class="comment"># 编译并打Debug包</span></div><div class="line">gradle assembleDebug</div><div class="line"></div><div class="line"><span class="comment"># 编译并打Release包</span></div><div class="line">gradle assembleRelease</div></pre></td></tr></table></figure>
<p>定义一个依赖通常需要三个元素：</p>
<ul>
<li>group:创建该library的组织名，通常也会是包名，</li>
<li>name :是该library的唯一标识</li>
<li>version:该library的版本号</li>
</ul>
<p>一个简单的打包命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle -p cc-web-boot bootRun</div></pre></td></tr></table></figure>
<p>-p参数指定项目(project directory)的目录，如果不指定就是当前目录(-p, –project-dir,Specifies the start directory for Gradle. Defaults to current directory)。bootRun指代的是当前项目下的任务名称。打包完成后，生成的包文件在对应项目文件的build/libs目录下。使用命令查看当前property：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看当前所有的Property</span></div><div class="line">gradle properties</div></pre></td></tr></table></figure>
<p>其中allprojects表示所有的Project，在多项目构建中，它将包含多个Project；buildDir表示构建结果的输出目录。如果需要刷新缓存，那么需要在构建命令后添加参数<code>--refresh-dependencies</code>，在命令行中刷新缓存有一个好处就是可以看到文件下载的进度和速度，如果在Intellij Idea中刷新是无法看到的。</p>
<h4 id="构建-build"><a href="#构建-build" class="headerlink" title="构建(build)"></a>构建(build)</h4><h5 id="构建常见问题"><a href="#构建常见问题" class="headerlink" title="构建常见问题"></a>构建常见问题</h5><h6 id="错误-编码GBK的不可映射字符"><a href="#错误-编码GBK的不可映射字符" class="headerlink" title="错误: 编码GBK的不可映射字符"></a>错误: 编码GBK的不可映射字符</h6><p>在使用Gradle部署的时候出现此错误，原因是由于java源文件的编码采用的是UTF-8编码，而本地Java编译器默认的编码采用的是操作系统的默认编码，在Window 7下默认是GBK，所以出现了此错误。解决方法就是显示指定JDK编译器的编码为UTF-8。在系统环境变量中增加一个变量，变量名为: <code>JAVA_TOOL_OPTIONS</code>， 变量值为：<code>-Dfile.encoding=UTF-8</code>，保存，重新打开命令提示符，再运行一次刚刚的构建的命令即可。</p>
<h4 id="Resolving-dependencies-‘-classpath’"><a href="#Resolving-dependencies-‘-classpath’" class="headerlink" title="Resolving dependencies ‘:classpath’"></a>Resolving dependencies ‘:classpath’</h4><p>在使用命令构建时一直停留在<code>Resolving dependencies &#39;:classpath&#39;</code>输出，无法往下进行构建。此时可以检查Maven的URL是否可以正常访问，此处是最初使用的地址是公司内部的局域网中的Maven仓库，在客户现场后即无法访问公司的内部网路，将原来无法访问的局域网的地址<code>htttp://dn6:8078</code>修改为广域网Maven公共仓库的地址<code>http://repox.gtan.com:8078</code>即可。由此可以知道原因是Maven的Url此时指定的是内网的URL，而当前电脑无法连接到内网的服务器，所以会一直停留在解析依赖的输出，将Maven仓库的URL改为外网即可成功构建。</p>
<h4 id="插件-Plugin"><a href="#插件-Plugin" class="headerlink" title="插件(Plugin)"></a>插件(Plugin)</h4><p>插件就是Gradle的扩展，简而言之就是为你添加一些非常有用的默认配置。Gradle 自带了很多插件，并且你也可以很容易的编写和分享自己的插件。Java plugin 作为其中之一，为你提供了诸如编译，测试，打包等一些功能。插件配置示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;java&apos;</div><div class="line">apply plugin: &apos;propdeps&apos;</div><div class="line">apply plugin: &apos;org.springframework.boot&apos;</div></pre></td></tr></table></figure>
<p>如上写法为旧式写法(Legacy)。另一种使用二进制插件的写法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">plugins &#123;</div><div class="line">    id &apos;java&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Gradle常用的插件有：</p>
<table>
<thead>
<tr>
<th>插件名称</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>java</td>
<td>Gradle是一个通用构建工具，也就是说，它不单是为Java而生。比如，还可以做Groovy，Scala的构建。这取决于使用什么样的插件。大部分Java项目的基本步骤都非常类似，编译Java源代码，运行单元测试，拷贝生成的class文件到目标目录，打包Jar文件（或者war包，ear包），而这些重复且约定俗成的任务，如果可以不用写一行构建代码就实现就完美了。Maven就做到这一点，采用约定优于配置的思想，预先定义常用的任务，并定义它们的执行顺序。Gradle吸收了Maven的这个优点，通过插件，实现预定义任务和任务之间依赖关系的导入，这样就可以在一行代码都不写的情况下，直接使用已经定义的任务。</td>
</tr>
<tr>
<td>war</td>
<td>War 的插件继承自 Java 插件并添加了对组装 web 应用程序的 WAR 文件的支持。它禁用了 Java 插件生成默认的 JAR archive，并添加了一个默认的 WAR archive 任务。 War 插件添加了两个依赖配置： <code>providedCompile</code>和<code>providedRuntime</code>。虽然它们有各自的<code>compile</code>和<code>runtime</code>配置，但这些配置有相同的作用域，只是它们不会添加到 WAR 文件中。</td>
</tr>
<tr>
<td>scala</td>
<td>Scala 的插件继承自 Java 插件并添加了对 Scala 项目的支持。它可以处理 Scala 代码，以及混合的 Scala 和 Java 代码，甚至是纯 Java 代码。该插件支持联合编译，联合编译可以通过 Scala 及 Java 的各自的依赖任意地混合及匹配它们的代码。例如，一个 Scala 类可以继承自一个 Java 类，而这个 Java 类也可以继承自一个 Scala 类。这样一来，我们就能够在项目中使用最适合的语言，并且在有需要的情况下用其他的语言重写其中的任何类。</td>
</tr>
<tr>
<td>propdeps</td>
<td>此插件的作用是为Gradle提供另2个依赖配置(provided、optional)，和Maven生成的POM配置兼容。因为Gradle的依赖定义是：compile、runtime、testCompile和testRuntime，而Maven的依赖定义是：compile、compile、runtime、test和system。</td>
</tr>
</tbody>
</table>
<h5 id="插件属性-Plugin-Properties"><a href="#插件属性-Plugin-Properties" class="headerlink" title="插件属性(Plugin Properties)"></a>插件属性(Plugin Properties)</h5><p>Java插件有一些扩展属性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Java version compatibility to use when compiling Java source.</div><div class="line">sourceCompatibility = 1.8</div><div class="line"># Java version to generate classes for.</div><div class="line">targetCompatibility = 1.8</div></pre></td></tr></table></figure>
<h4 id="SourceSet和项目布局"><a href="#SourceSet和项目布局" class="headerlink" title="SourceSet和项目布局"></a>SourceSet和项目布局</h4><p>Java插件引入了一个概念叫做SourceSets，它代表了一组源文件，通过修改SourceSets中的属性，可以指定哪些源文件（或文件夹下的源文件）要被编译，哪些源文件要被排除。Gradle就是通过它实现Java项目的布局定义。</p>
<p>Java插件默认实现了两个SourceSet，main和test。每个SourceSet都提供了一系列的属性，通过这些属性，可以定义该SourceSet所包含的源文件。比如，java.srcDirs，resources.srcDirs。Java插件中定义的其他任务，就根据main和test的这两个SourceSet的定义来寻找产品代码和测试代码等。</p>
<h4 id="Wrapper"><a href="#Wrapper" class="headerlink" title="Wrapper"></a>Wrapper</h4><p>Wrapper主要是考虑在没有安装Gradle的电脑上使用Gradle命令。当执行gradlew(Gradle Wrapper)命令时，首先会检查电脑是否安装了Gradle，如果没有安装，会自动从gradle repository下载安装。注意安装不会真的在计算机中安装Gradle的发行版本，它会下载Gradle，存放在目录<code>$USER_HOME/.gradle/wrapper/dists</code>下，构建时使用命令调用而不是直接添加到当前计算机(试想如果不同的Gradle版本，如果添加到系统的环境变量了，构建时到底是以调用哪一个版本的Gradle呢)。需要查看Gradle Wrapper帮助，在命令行中输入如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle Wrapper --help</div></pre></td></tr></table></figure>
<p>会打印出所有Gradle Wrapper.Most tools require installation on your computer before you can use them. If the installation is easy, you may think that’s fine. But it can be an unnecessary burden on the users of the build. Equally importantly, will the user install the right version of the tool for the build? What if they’re building an old version of the software? The Gradle Wrapper (henceforth referred to as the “Wrapper”) solves both these problems and is the preferred way of starting a Gradle build.需要添加Wrapper，在gradle.build中添加如下block:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">task wrapper(type: Wrapper) &#123;</div><div class="line">    description = &apos;Generates gradlew[.bat] scripts&apos;</div><div class="line">    gradleVersion = &apos;3.2.1&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>或者执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle wrapper --gradle-version 3.2.1</div></pre></td></tr></table></figure>
<p>命令执行之后，会生成wrapper任务脚本，和如下文件夹及文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">gradlew</div><div class="line">gradlew.bat</div><div class="line">    gradle/wrapper/</div><div class="line">    gradle-wrapper.jar</div><div class="line">    gradle-wrapper.properties</div></pre></td></tr></table></figure>
<p>在gradle-wrapper.properties中的gradle_user_home ，默认是用户的home目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Note, «GRADLE_USER_HOME» defaults to «USER_HOME»/.gradle, </div><div class="line">where «USER_HOME» is the home directory of the current user. </div><div class="line">This location can be configured via the -g </div><div class="line">and --gradle-user-home command line switches, </div><div class="line">as well as by the GRADLE_USER_HOME environment variable </div><div class="line">and org.gradle.user.home JVM system property.</div></pre></td></tr></table></figure>
<h4 id="Gradle界面-GUI"><a href="#Gradle界面-GUI" class="headerlink" title="Gradle界面(GUI)"></a>Gradle界面(GUI)</h4><p>在终端中输入如下命令可以查看Gradle的GUI：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle --gui</div></pre></td></tr></table></figure>
<h4 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h4><p>安装指定版本的软件可以使用如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt install gradle=2.12</div></pre></td></tr></table></figure>
<p>其中gradle是软件包的名称，2.12是软件包的版本。</p>
<h4 id="运行特定项目的任务"><a href="#运行特定项目的任务" class="headerlink" title="运行特定项目的任务"></a>运行特定项目的任务</h4><p>此处运行项目cc-web-boot下的bootRepackage任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./gradlew build -p cc-web-boot/ bootRepackage -x <span class="built_in">test</span></div></pre></td></tr></table></figure>
<p>如上命令在项目文件夹cc-web-boot下执行构建，并排除test任务，生成对应的jar包。bootRepackage任务依赖于Gradle assemble任务，assemble任务会编译程序中的源代码，并打包生成Jar文件，这个任务不执行单元测试。不使用spring-boot插件，主程序jar包，与依赖的jar包是分开的，需要分别打包，这在云环境中，上传部署比较麻烦，得传多个文件（或者上传前，先压缩成一个包，再传到服务器上解压），服务器节点多时，操作起来太累又重复。而使用spring-boot插件，会自动将依赖的包集成到主包里，非常方便。</p>
<h4 id="多项目构建"><a href="#多项目构建" class="headerlink" title="多项目构建"></a>多项目构建</h4><p>使用gradle构建多项目时，setting.gradle文件时必须存在的。并且要包含多个项目，示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">include &quot;dolphin-framework&quot;, &quot;dolphin-common&quot;</div></pre></td></tr></table></figure>
<p>在多项目构建时，指定多项目共同的中央仓库，可以使用allproject块,如下代码片段所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        maven &#123; url &apos;http://repox.gtan.com:8078&apos; &#125;</div><div class="line">        mavenCentral()</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>mavenCentral指代Maven的中央仓库(Maven central repository)，jcenter指代的是Java中央仓库(JCenter repository)。在构建项目时，IDE中可能看不到jar包的下载进度(如：Intellij Idea)，此时可以切换到命令行模式，执行<code>gradle build</code>命令，可以看到构建的进度，比如文件下载的进度等。</p>
<h4 id="buildscript"><a href="#buildscript" class="headerlink" title="buildscript"></a>buildscript</h4><p>buildscript中的声明是gradle脚本自身需要使用的资源。可以声明的资源包括依赖项、第三方插件、maven仓库地址等。而在build.gradle文件中直接声明的依赖项、仓库地址等信息是项目自身需要的资源。</p>
<p>gradle是由groovy语言编写的，支持groovy语法，可以灵活的使用已有的各种ant插件、基于jvm的类库，这也是它比maven、ant等构建脚本强大的原因。虽然gradle支持开箱即用，但是如果你想在脚本中使用一些第三方的插件、类库等，就需要自己手动添加对这些插件、类库的引用。而这些插件、类库又不是直接服务于项目的，而是支持其它build脚本的运行。所以你应当将这部分的引用放置在buildscript代码块中。gradle在执行脚本时，会优先执行buildscript代码块中的内容，然后才会执行剩余的build脚本。buildscript脚本的简单示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    ext &#123;</div><div class="line">        springBootVersion = &apos;1.4.2.RELEASE&apos;</div><div class="line">        jacksonVersion = &apos;2.8.4&apos;</div><div class="line">        tomcatVersion = &apos;7.0.70&apos;</div><div class="line">        springfoxVersion = &apos;2.6.1&apos;</div><div class="line">        poiVersion = &quot;3.14&quot;</div><div class="line">    &#125;</div><div class="line">    repositories &#123;</div><div class="line">        maven &#123; url &apos;http://repox.gtan.com:8078&apos; &#125;</div><div class="line">        mavenCentral()</div><div class="line">        jcenter()</div><div class="line">        maven &#123; url &apos;http://repo.spring.io/plugins-release&apos; &#125;</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:$&#123;springBootVersion&#125;&quot;)</div><div class="line">        classpath &apos;org.springframework.build.gradle:propdeps-plugin:0.0.7&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中，ext为扩展属性(Extra properties),All enhanced objects in Gradle’s domain model can hold extra user-defined properties. This includes, but is not limited to, projects, tasks, and source sets. Extra properties can be added, read and set via the owning object’s ext property. Alternatively, an ext block can be used to add multiple properties at once.扩展属性在buildscript中指定后，可以在整个gradle脚本中使用(${属性名})。使用命令<code>gradle buildEnvironment</code>，可以打印出扩展属性到依赖关系图。</p>
<p>Note, «GRADLE_USER_HOME» defaults to «USER_HOME»/.gradle, where «USER_HOME» is<br>the home directory of the current user. This location can be configured via the -g and –gradle-user-home command line switches, as well as by the GRADLE_USER_HOME environment variable and org.gradle.user.home JVM system property.</p>
<h4 id="设置源码路径"><a href="#设置源码路径" class="headerlink" title="设置源码路径"></a>设置源码路径</h4><p>在混合编程中，需要设置不同开发语言的源码路径，如下代码片段所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">sourceSets &#123;</div><div class="line">    main &#123;</div><div class="line">        scala &#123;</div><div class="line">            srcDirs = [&apos;src/main/scala&apos;, &apos;src/main/java&apos;]</div><div class="line">        &#125;</div><div class="line">        java &#123;</div><div class="line">            srcDirs = []</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    test &#123;</div><div class="line">        scala &#123;</div><div class="line">            srcDirs = [&apos;src/test/scala&apos;, &apos;src/test/java&apos;]</div><div class="line">        &#125;</div><div class="line">        java &#123;</div><div class="line">            srcDirs = []</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Gradle构建生命周期-Gradle-Build-Lifecycle"><a href="#Gradle构建生命周期-Gradle-Build-Lifecycle" class="headerlink" title="Gradle构建生命周期(Gradle Build Lifecycle)"></a>Gradle构建生命周期(Gradle Build Lifecycle)</h4><p>关于Gradle构建的生命周期，全部都是Gradle用户使用手册里面的内容，这里仅仅是摘抄而已，可以直接下载用户手册进行阅读。</p>
<p>初始化阶段(Initialization):Gradle supports single and multi-project builds. During the initialization phase, Gradle determines which projects are going to take part in the build, and creates a Project instance for each of these projects.</p>
<p>配置阶段(Configuration):During this phase the project objects are configured. The build scripts of all projects which are part of the build are executed. Gradle 1.4 introduced an incubating opt-in feature called configuration on demand . In this mode, Gradle configures only relevant projects.</p>
<p>执行阶段(Execution):Gradle determines the subset of the tasks, created and configured during the configuration phase, to be executed. The subset is determined by the task name arguments passed to the gradle command and the current directory. Gradle then executes each of the selected tasks.</p>
<p>Gradle构建流程如下,这是在实际执行Gradle构建指令后窗口输出的内容：processResources -&gt; compileJava -&gt; classes -&gt; jar。</p>
<img src="/2016/12/27/gradle-using/gradle-build-workflow.jpg" alt="Gradle构建流程" title="Gradle构建流程">
<p>Gradle构建时，会先构建依赖包，再构建主要的包。每个包的构建按照上图的流程反复执行。processResources任务拷贝资源到生产环境的resource目录下(Copies production resources into the production resources directory).</p>
<h4 id="Intellij-Idea构建Gradle版本"><a href="#Intellij-Idea构建Gradle版本" class="headerlink" title="Intellij Idea构建Gradle版本"></a>Intellij Idea构建Gradle版本</h4><p>在Intellij Idea中使用Gradle Wrapper构建时，有时明明指定的是某一个版本，Intellij Idea却去下载另一个版本，例如在build.gradle中指定的是3.2.1版本，而Intellij Idea却下载Gradle 2.13版本。此时需要执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 刷新gradle wrapper（regenerate the wrapper with gradle(w) wrapper after changing gradleVersion）</div><div class="line">./gradlew wrapper</div><div class="line"># 指定版本</div><div class="line">./gradlew wrapper --gradle-version 3.2.1</div></pre></td></tr></table></figure>
<p>参考资料：</p>
<ul>
<li><p><a href="https://docs.gradle.org/current/userguide/multi_project_builds.html" target="_blank" rel="external">Multi-project Builds</a></p>
</li>
<li><p><a href="">Gradle Userguide</a></p>
</li>
<li><p><a href="https://docs.gradle.org/current/dsl/" target="_blank" rel="external">Gradle Build Language Reference</a></p>
</li>
<li><p><a href="https://blog.gmem.cc/gradle-study-note" target="_blank" rel="external">Gradle学习笔记</a></p>
</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Gradle/" rel="tag"># Gradle</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/27/rest-api-doc/" rel="next" title="Restful API文档编写">
                <i class="fa fa-chevron-left"></i> Restful API文档编写
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/27/elasticsearch-introduce/" rel="prev" title="ElasticSearch入门">
                ElasticSearch入门 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/12/27/gradle-using/"
           data-title="Gradle使用经验总结" data-url="http://jiangxiaoqiang.com/2016/12/27/gradle-using/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="xiaoqiang jiang" />
          <p class="site-author-name" itemprop="name">xiaoqiang jiang</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">234</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">214</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              推荐博客
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.ruanyifeng.com/home.html" title="阮一峰的个人网站" target="_blank">阮一峰的个人网站</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://coolshell.cn" title="陈皓(CoolShell)" target="_blank">陈皓(CoolShell)</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://jm.taobao.org" title="阿里中间件团队博客" target="_blank">阿里中间件团队博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://wdxtub.com" title="小土刀的博客" target="_blank">小土刀的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://lucida.me" title="Lucida的博客" target="_blank">Lucida的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://stormzhang.com" title="stormzhang的博客" target="_blank">stormzhang的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.raychase.net" title="四火的唠叨" target="_blank">四火的唠叨</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么使用Gradle"><span class="nav-number">1.</span> <span class="nav-text">为什么使用Gradle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#手动安装Gradle"><span class="nav-number">2.</span> <span class="nav-text">手动安装Gradle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基础"><span class="nav-number">3.</span> <span class="nav-text">基础</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#构建-build"><span class="nav-number">4.</span> <span class="nav-text">构建(build)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#构建常见问题"><span class="nav-number">4.1.</span> <span class="nav-text">构建常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#错误-编码GBK的不可映射字符"><span class="nav-number">4.1.1.</span> <span class="nav-text">错误: 编码GBK的不可映射字符</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Resolving-dependencies-‘-classpath’"><span class="nav-number">5.</span> <span class="nav-text">Resolving dependencies ‘:classpath’</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#插件-Plugin"><span class="nav-number">6.</span> <span class="nav-text">插件(Plugin)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#插件属性-Plugin-Properties"><span class="nav-number">6.1.</span> <span class="nav-text">插件属性(Plugin Properties)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SourceSet和项目布局"><span class="nav-number">7.</span> <span class="nav-text">SourceSet和项目布局</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Wrapper"><span class="nav-number">8.</span> <span class="nav-text">Wrapper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Gradle界面-GUI"><span class="nav-number">9.</span> <span class="nav-text">Gradle界面(GUI)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#软件包管理"><span class="nav-number">10.</span> <span class="nav-text">软件包管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运行特定项目的任务"><span class="nav-number">11.</span> <span class="nav-text">运行特定项目的任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多项目构建"><span class="nav-number">12.</span> <span class="nav-text">多项目构建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#buildscript"><span class="nav-number">13.</span> <span class="nav-text">buildscript</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置源码路径"><span class="nav-number">14.</span> <span class="nav-text">设置源码路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Gradle构建生命周期-Gradle-Build-Lifecycle"><span class="nav-number">15.</span> <span class="nav-text">Gradle构建生命周期(Gradle Build Lifecycle)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Intellij-Idea构建Gradle版本"><span class="nav-number">16.</span> <span class="nav-text">Intellij Idea构建Gradle版本</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiaoqiang jiang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jiangxiaoqiang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  












  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


</body>
</html>
